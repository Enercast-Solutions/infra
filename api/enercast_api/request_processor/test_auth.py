from .auth import AuthContextProcessor
from ..models import AuthContext


def test_process_event() -> None:
    test_event = {'version': '2.0', 'routeKey': 'POST /user/submit_prediction', 'rawPath': '/user/submit_prediction', 'rawQueryString': '', 'headers': {'accept': '*/*', 'accept-encoding': 'gzip, deflate, br', 'accept-language': 'en-US,en;q=0.9', 'authorization': '....', 'cache-control': 'no-cache', 'content-length': '195', 'content-type': 'application/json', 'host': 'ewibuq9g18.execute-api.us-east-2.amazonaws.com', 'origin': 'http://localhost:3000', 'pragma': 'no-cache', 'sec-ch-ua': '"Google Chrome";v="89", "Chromium";v="89", ";Not A Brand";v="99"', 'sec-ch-ua-mobile': '?0', 'sec-fetch-dest': 'empty', 'sec-fetch-mode': 'cors', 'sec-fetch-site': 'cross-site', 'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36', 'x-amzn-trace-id': 'Root=1-605cf46f-6a66426c32d5b6671bb686fc', 'x-forwarded-for': '108.31.146.105', 'x-forwarded-port': '443', 'x-forwarded-proto': 'https'}, 'requestContext': {'accountId': '460407672535', 'apiId': 'ewibuq9g18', 'authorizer': {'jwt': {'claims': {'auth_time': '1616685940', 'client_id': '2ocbukrlahfa5l9d595llbtfm5', 'event_id': '4b49ecf2-a817-4118-8838-a799f6d13b12', 'exp': '1616707625', 'iat': '1616704025', 'iss': 'https://cognito-idp.us-east-2.amazonaws.com/us-east-2_qtBoat5ir', 'jti': '3c65e4a6-ba8b-4d94-968f-4bd0c7410421', 'scope': 'aws.cognito.signin.user.admin', 'sub': '314e7d49-b24f-49f6-a5f3-8baac59e65bc', 'token_use': 'access', 'username': '314e7d49-b24f-49f6-a5f3-8baac59e65bc'}, 'scopes': None}}, 'domainName': 'ewibuq9g18.execute-api.us-east-2.amazonaws.com', 'domainPrefix': 'ewibuq9g18', 'http': {'method': 'POST', 'path': '/user/submit_prediction', 'protocol': 'HTTP/1.1', 'sourceIp': '108.31.146.105', 'userAgent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.82 Safari/537.36'}, 'requestId': 'cwshXhLVCYcEJ6w=', 'routeKey': 'POST /user/submit_prediction', 'stage': '$default', 'time': '25/Mar/2021:20:37:03 +0000', 'timeEpoch': 1616704623078}, 'body': '{"prediction_parameters":{"event_name":"dsfsdfsdf","start_date":"2021-03-25","end_date":"2021-03-31","setup_days":"3","teardown_days":"3","sqft":"1000","forecast_attendance":"50","is_audio":"0"}}', 'isBase64Encoded': False}
    processor = AuthContextProcessor()

    assert processor.process_event(test_event) == AuthContext('314e7d49-b24f-49f6-a5f3-8baac59e65bc')
